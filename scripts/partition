#!/usr/bin/env bash

sfdisk /dev/sda <<EOF
,4194304,S
;
EOF
mkfs.btrfs -f -L storage /dev/sda2
mkswap -L swap /dev/sda1

mount -o compress=lzo,noatime,nodiratime,space_cache /dev/sda2 /mnt
cd /mnt
btrfs subvolume create system
btrfs subvolume create home
cd ~
umount /mnt

mount -o compress=lzo,noatime,nodiratime,space_cache,subvol=system /dev/sda2 /mnt
mkdir /mnt/home
mount -o compress=lzo,noatime,nodiratime,space_cache,subvol=home /dev/sda2 /mnt/home
swapon -o discard=once /dev/sda1
